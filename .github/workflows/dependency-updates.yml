name: ğŸ”„ Automated Dependency Updates & Security Scanning

on:
  schedule:
    # Run daily at 2 AM KST (17:00 UTC)
    - cron: '0 17 * * *'
  workflow_dispatch:
    inputs:
      scan_type:
        description: 'Type of scan to perform'
        required: false
        default: 'full'
        type: choice
        options:
          - full
          - security-only
          - updates-only

env:
  PYTHON_VERSION: '3.11'
  NODE_VERSION: '18'

jobs:
  # ================================
  # VULNERABILITY SCANNING
  # ================================
  vulnerability-scan:
    name: ğŸ›¡ï¸ Vulnerability Scanning
    runs-on: ubuntu-latest
    outputs:
      vulnerabilities-found: ${{ steps.scan-results.outputs.vulnerabilities-found }}
      critical-count: ${{ steps.scan-results.outputs.critical-count }}
      high-count: ${{ steps.scan-results.outputs.high-count }}
      
    steps:
    - name: ğŸ“¥ Checkout Code
      uses: actions/checkout@v4
      
    - name: ğŸ Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        
    - name: ğŸ“¦ Install Security Tools
      run: |
        pip install --upgrade pip
        pip install safety bandit semgrep pip-audit
        
    - name: ğŸ” Python Dependency Security Scan (Safety)
      run: |
        echo "::group::Python ì˜ì¡´ì„± ë³´ì•ˆ ìŠ¤ìº” (Safety)"
        safety check --json --output safety-report.json || true
        safety check --short-report || echo "ì·¨ì•½ì  ë°œê²¬ë¨"
        echo "::endgroup::"
        
    - name: ğŸ” Python Dependency Audit (pip-audit)  
      run: |
        echo "::group::Python ì˜ì¡´ì„± ê°ì‚¬ (pip-audit)"
        pip-audit --format=json --output=pip-audit-report.json || true
        pip-audit --format=cyclonedx-json --output=sbom.json || true
        echo "::endgroup::"
        
    - name: ğŸ” Code Security Analysis (Bandit)
      run: |
        echo "::group::Python ì½”ë“œ ë³´ì•ˆ ë¶„ì„ (Bandit)"
        bandit -r src/ -f json -o bandit-report.json || true
        bandit -r src/ --severity-level medium || echo "ë³´ì•ˆ ì´ìŠˆ ë°œê²¬ë¨"
        echo "::endgroup::"
        
    - name: ğŸ” Advanced Security Scan (Semgrep)
      run: |
        echo "::group::ê³ ê¸‰ ë³´ì•ˆ ìŠ¤ìº” (Semgrep)"
        semgrep --config=auto --json --output=semgrep-report.json src/ || true
        semgrep --config=auto src/ || echo "Semgrep ì´ìŠˆ ë°œê²¬ë¨"
        echo "::endgroup::"
        
    - name: ğŸ“Š Analyze Scan Results
      id: scan-results
      run: |
        echo "ğŸ” ë³´ì•ˆ ìŠ¤ìº” ê²°ê³¼ ë¶„ì„ ì¤‘..."
        
        # Safety report analysis
        if [ -f "safety-report.json" ]; then
          safety_vulns=$(jq '.vulnerabilities | length' safety-report.json 2>/dev/null || echo "0")
          echo "Safety ì·¨ì•½ì : $safety_vulnsê°œ"
        else
          safety_vulns=0
        fi
        
        # pip-audit report analysis  
        if [ -f "pip-audit-report.json" ]; then
          audit_vulns=$(jq '.vulnerabilities | length' pip-audit-report.json 2>/dev/null || echo "0")
          echo "pip-audit ì·¨ì•½ì : $audit_vulnsê°œ"
        else
          audit_vulns=0
        fi
        
        # Bandit report analysis
        if [ -f "bandit-report.json" ]; then
          bandit_high=$(jq '.results[] | select(.issue_severity == "HIGH")' bandit-report.json | jq -s 'length' || echo "0")
          bandit_medium=$(jq '.results[] | select(.issue_severity == "MEDIUM")' bandit-report.json | jq -s 'length' || echo "0") 
          echo "Bandit ê³ ìœ„í—˜: $bandit_highê°œ, ì¤‘ìœ„í—˜: $bandit_mediumê°œ"
        else
          bandit_high=0
          bandit_medium=0
        fi
        
        # Calculate totals
        total_critical=$((safety_vulns + audit_vulns + bandit_high))
        total_high=$bandit_medium
        total_vulns=$((total_critical + total_high))
        
        echo "vulnerabilities-found=$total_vulns" >> $GITHUB_OUTPUT
        echo "critical-count=$total_critical" >> $GITHUB_OUTPUT  
        echo "high-count=$total_high" >> $GITHUB_OUTPUT
        
        # Korean summary
        echo "ğŸ“Š ë³´ì•ˆ ìŠ¤ìº” ì™„ë£Œ ê²°ê³¼:"
        echo "  - ì´ ì·¨ì•½ì : ${total_vulns}ê°œ"
        echo "  - ì‹¬ê°/ë†’ìŒ: ${total_critical}ê°œ"
        echo "  - ë³´í†µ: ${total_high}ê°œ"
        
    - name: ğŸ“‹ Upload Security Reports
      uses: actions/upload-artifact@v3
      if: always()
      with:
        name: security-reports
        path: |
          safety-report.json
          pip-audit-report.json
          bandit-report.json
          semgrep-report.json
          sbom.json
        retention-days: 30

  # ================================
  # DEPENDENCY UPDATE ANALYSIS
  # ================================
  dependency-analysis:
    name: ğŸ“¦ Dependency Analysis & Updates
    runs-on: ubuntu-latest
    needs: vulnerability-scan
    outputs:
      updates-available: ${{ steps.check-updates.outputs.updates-available }}
      security-updates: ${{ steps.check-updates.outputs.security-updates }}
      
    steps:
    - name: ğŸ“¥ Checkout Code
      uses: actions/checkout@v4
      
    - name: ğŸ Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        
    - name: ğŸ“¦ Install Update Tools
      run: |
        pip install --upgrade pip
        pip install pip-tools pip-check-reqs pur
        
    - name: ğŸ” Check for Outdated Packages
      id: check-updates
      run: |
        echo "::group::ì˜ì¡´ì„± ì—…ë°ì´íŠ¸ í™•ì¸"
        
        # Create requirements analysis
        echo "ğŸ“‹ í˜„ì¬ ì„¤ì¹˜ëœ íŒ¨í‚¤ì§€ ë¶„ì„..."
        pip list --format=json > current-packages.json
        
        # Check for outdated packages
        echo "ğŸ” ì—…ë°ì´íŠ¸ ê°€ëŠ¥í•œ íŒ¨í‚¤ì§€ í™•ì¸..."
        pip list --outdated --format=json > outdated-packages.json
        
        # Analyze outdated packages
        outdated_count=$(jq '. | length' outdated-packages.json)
        
        # Check for security updates
        security_updates=0
        if [ -f "../vulnerability-scan/safety-report.json" ]; then
          security_updates=$(jq '.vulnerabilities | length' ../vulnerability-scan/safety-report.json 2>/dev/null || echo "0")
        fi
        
        echo "updates-available=$outdated_count" >> $GITHUB_OUTPUT
        echo "security-updates=$security_updates" >> $GITHUB_OUTPUT
        
        echo "ğŸ“Š ì˜ì¡´ì„± ë¶„ì„ ê²°ê³¼:"
        echo "  - ì—…ë°ì´íŠ¸ ê°€ëŠ¥: ${outdated_count}ê°œ"
        echo "  - ë³´ì•ˆ ì—…ë°ì´íŠ¸ í•„ìš”: ${security_updates}ê°œ"
        
        # Generate update recommendations
        if [ $outdated_count -gt 0 ]; then
          echo "ğŸ“‹ ì—…ë°ì´íŠ¸ ê¶Œì¥ì‚¬í•­:"
          jq -r '.[] | "  - \(.name): \(.version) â†’ \(.latest_version)"' outdated-packages.json | head -10
        fi
        
        echo "::endgroup::"
        
    - name: ğŸ”„ Generate Updated Requirements
      if: steps.check-updates.outputs.updates-available > 0
      run: |
        echo "::group::ì—…ë°ì´íŠ¸ëœ requirements.txt ìƒì„±"
        
        # Backup original requirements
        cp requirements.txt requirements.txt.backup
        
        # Generate updated requirements (conservative approach)
        echo "ğŸ”§ ë³´ìˆ˜ì  ì—…ë°ì´íŠ¸ ìƒì„± (íŒ¨ì¹˜ ë²„ì „ë§Œ)..."
        pur -r requirements.txt --patch --dry-run > requirements-patch-updates.txt
        
        echo "ğŸ”§ ë§ˆì´ë„ˆ ì—…ë°ì´íŠ¸ ìƒì„± (ë§ˆì´ë„ˆ ë²„ì „ í¬í•¨)..."
        pur -r requirements.txt --minor --dry-run > requirements-minor-updates.txt
        
        echo "ğŸ”§ ë©”ì´ì € ì—…ë°ì´íŠ¸ ìƒì„± (ëª¨ë“  ì—…ë°ì´íŠ¸)..."
        pur -r requirements.txt --dry-run > requirements-major-updates.txt
        
        # Check compatibility
        echo "ğŸ§ª ì—…ë°ì´íŠ¸ëœ ì˜ì¡´ì„± í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸..."
        pur -r requirements.txt --patch --force
        pip install -r requirements.txt --dry-run || echo "âŒ íŒ¨ì¹˜ ì—…ë°ì´íŠ¸ í˜¸í™˜ì„± ë¬¸ì œ"
        
        # Restore original
        cp requirements.txt.backup requirements.txt
        
        echo "::endgroup::"
        
    - name: ğŸ“‹ Upload Dependency Reports
      uses: actions/upload-artifact@v3
      if: always()
      with:
        name: dependency-reports
        path: |
          current-packages.json
          outdated-packages.json
          requirements-*-updates.txt
          requirements.txt.backup
        retention-days: 30

  # ================================
  # AUTOMATED SECURITY FIXES
  # ================================
  security-fixes:
    name: ğŸ”§ Automated Security Fixes
    runs-on: ubuntu-latest
    needs: [vulnerability-scan, dependency-analysis]
    if: needs.vulnerability-scan.outputs.critical-count > 0
    
    steps:
    - name: ğŸ“¥ Checkout Code
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: ğŸ Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        
    - name: ğŸ“¦ Install Fix Tools
      run: |
        pip install --upgrade pip
        pip install safety pur pip-audit
        
    - name: ğŸ”§ Apply Critical Security Fixes
      id: apply-fixes
      run: |
        echo "ğŸš¨ ì‹¬ê°í•œ ë³´ì•ˆ ì·¨ì•½ì  ìë™ ìˆ˜ì • ì‹œì‘..."
        
        fixes_applied=0
        
        # Download security reports
        if [ ! -f "safety-report.json" ]; then
          echo "âš ï¸ ë³´ì•ˆ ë¦¬í¬íŠ¸ ì—†ìŒ"
          exit 0
        fi
        
        # Parse vulnerabilities and apply fixes
        echo "ğŸ” ì·¨ì•½ì  ë¶„ì„ ë° ìˆ˜ì • ì ìš©..."
        
        # Apply only patch-level security fixes (conservative)
        if safety check --full-report | grep -q "vulnerability"; then
          echo "ğŸ”§ ë³´ì•ˆ íŒ¨ì¹˜ ì ìš© ì¤‘..."
          pur -r requirements.txt --patch --force
          fixes_applied=$((fixes_applied + 1))
          echo "âœ… ë³´ì•ˆ íŒ¨ì¹˜ ì ìš© ì™„ë£Œ"
        fi
        
        echo "fixes-applied=$fixes_applied" >> $GITHUB_OUTPUT
        
        # Verify fixes
        echo "âœ… ìˆ˜ì • ì‚¬í•­ ê²€ì¦ ì¤‘..."
        pip install -r requirements.txt --dry-run
        safety check --short-report || echo "âš ï¸ ì¼ë¶€ ì·¨ì•½ì ì´ ì—¬ì „íˆ ì¡´ì¬í•©ë‹ˆë‹¤"
        
    - name: ğŸ“ Create Security Fix PR
      if: steps.apply-fixes.outputs.fixes-applied > 0
      uses: peter-evans/create-pull-request@v5
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: |
          ğŸ”’ ìë™ ë³´ì•ˆ ìˆ˜ì •: ì‹¬ê°í•œ ì·¨ì•½ì  íŒ¨ì¹˜
          
          - ${{ needs.vulnerability-scan.outputs.critical-count }}ê°œ ì‹¬ê°í•œ ì·¨ì•½ì  ìˆ˜ì •
          - ë³´ìˆ˜ì  íŒ¨ì¹˜ ë ˆë²¨ ì—…ë°ì´íŠ¸ë§Œ ì ìš©
          - ìë™ ì•ˆì „ì„± ê²€ì¦ ì™„ë£Œ
          
          ğŸ¤– AI ìë™í™” í”Œë«í¼ v8.3.0ì— ì˜í•´ ìƒì„±ë¨
        title: "ğŸ”’ ê¸´ê¸‰ ë³´ì•ˆ ìˆ˜ì •: ${{ needs.vulnerability-scan.outputs.critical-count }}ê°œ ì‹¬ê°í•œ ì·¨ì•½ì  íŒ¨ì¹˜"
        body: |
          ## ğŸš¨ ìë™ ë³´ì•ˆ ìˆ˜ì • PR
          
          ### ğŸ“Š ìˆ˜ì •ëœ ì·¨ì•½ì  í˜„í™©
          - **ì‹¬ê°í•œ ì·¨ì•½ì **: ${{ needs.vulnerability-scan.outputs.critical-count }}ê°œ
          - **ë†’ì€ ìœ„í—˜ë„**: ${{ needs.vulnerability-scan.outputs.high-count }}ê°œ
          - **ì ìš©ëœ ìˆ˜ì •ì‚¬í•­**: ${{ steps.apply-fixes.outputs.fixes-applied }}ê°œ
          
          ### ğŸ”§ ì ìš©ëœ ìˆ˜ì •ì‚¬í•­
          - ë³´ìˆ˜ì  íŒ¨ì¹˜ ë ˆë²¨ ì—…ë°ì´íŠ¸ (ë§ˆì´ë„ˆ/ë©”ì´ì € ë²„ì „ ë³€ê²½ ì—†ìŒ)
          - ìë™ í˜¸í™˜ì„± ê²€ì¦ ì™„ë£Œ
          - ë³´ì•ˆ ìŠ¤ìº” ë„êµ¬ë¥¼ í†µí•œ ê²€ì¦ ì™„ë£Œ
          
          ### âš ï¸ ì£¼ì˜ì‚¬í•­
          - ì´ PRì€ ë³´ì•ˆìƒ ì‹¬ê°í•œ ì·¨ì•½ì ë§Œ ìˆ˜ì •í•©ë‹ˆë‹¤
          - í”„ë¡œë•ì…˜ ë°°í¬ ì „ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ì„ ê¶Œì¥í•©ë‹ˆë‹¤
          - ì¶”ê°€ ìˆ˜ë™ ê²€í† ê°€ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
          
          ### ğŸ¤– ìë™í™” ì •ë³´
          - ìƒì„±ì: AI ìë™í™” í”Œë«í¼ v8.3.0
          - ìŠ¤ìº” ì¼ì‹œ: ${{ github.run_started_at }}
          - ì›Œí¬í”Œë¡œìš°: ìë™ ì˜ì¡´ì„± ë° ë³´ì•ˆ ê´€ë¦¬
          
          ---
          **ğŸ” ìƒì„¸ ë³´ì•ˆ ë¦¬í¬íŠ¸ëŠ” Actions ì•„í‹°íŒ©íŠ¸ì—ì„œ í™•ì¸í•˜ì„¸ìš”.**
        branch: security-fixes/auto-${{ github.run_number }}
        delete-branch: true
        draft: false
        labels: |
          security
          automated
          critical

  # ================================
  # DEPENDENCY UPDATE PR
  # ================================
  dependency-updates-pr:
    name: ğŸ“¦ Dependency Updates PR
    runs-on: ubuntu-latest
    needs: [vulnerability-scan, dependency-analysis]
    if: needs.dependency-analysis.outputs.updates-available > 0
    
    steps:
    - name: ğŸ“¥ Checkout Code
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: ğŸ Set up Python  
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        
    - name: ğŸ“¦ Install Update Tools
      run: |
        pip install --upgrade pip
        pip install pur pip-tools
        
    - name: ğŸ”„ Apply Dependency Updates
      run: |
        echo "ğŸ“¦ ì˜ì¡´ì„± ì—…ë°ì´íŠ¸ ì ìš© ì¤‘..."
        
        # Conservative minor version updates only
        echo "ğŸ”§ ë§ˆì´ë„ˆ ë²„ì „ ì—…ë°ì´íŠ¸ ì ìš© (ì•ˆì „í•œ ì—…ë°ì´íŠ¸)..."
        pur -r requirements.txt --minor --force
        
        # Generate updated lockfile
        echo "ğŸ”’ ì—…ë°ì´íŠ¸ëœ lockfile ìƒì„±..."
        pip-compile requirements.txt --generate-hashes --output-file requirements.lock
        
        # Verify compatibility
        echo "âœ… í˜¸í™˜ì„± ê²€ì¦ ì¤‘..."
        pip install -r requirements.txt --dry-run
        
    - name: ğŸ§ª Run Basic Tests
      run: |
        echo "ğŸ§ª ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰..."
        
        # Install updated dependencies
        pip install -r requirements.txt
        
        # Run basic import tests
        python -c "
        import sys
        import importlib
        
        # Test critical imports
        critical_modules = ['flask', 'sqlalchemy', 'redis', 'psutil', 'requests']
        
        for module in critical_modules:
            try:
                importlib.import_module(module)
                print(f'âœ… {module} ì„í¬íŠ¸ ì„±ê³µ')
            except ImportError as e:
                print(f'âŒ {module} ì„í¬íŠ¸ ì‹¤íŒ¨: {e}')
                sys.exit(1)
        
        print('ğŸ‰ ëª¨ë“  í•µì‹¬ ëª¨ë“ˆ ì„í¬íŠ¸ ì„±ê³µ!')
        "
        
    - name: ğŸ“ Create Dependency Update PR
      uses: peter-evans/create-pull-request@v5
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: |
          ğŸ“¦ ì˜ì¡´ì„± ìë™ ì—…ë°ì´íŠ¸
          
          - ${{ needs.dependency-analysis.outputs.updates-available }}ê°œ íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸
          - ë§ˆì´ë„ˆ ë²„ì „ ì•ˆì „ ì—…ë°ì´íŠ¸ë§Œ ì ìš©
          - í˜¸í™˜ì„± ê²€ì¦ ë° ê¸°ë³¸ í…ŒìŠ¤íŠ¸ í†µê³¼
          
          ğŸ¤– AI ìë™í™” í”Œë«í¼ v8.3.0ì— ì˜í•´ ìƒì„±ë¨
        title: "ğŸ“¦ ì˜ì¡´ì„± ìë™ ì—…ë°ì´íŠ¸: ${{ needs.dependency-analysis.outputs.updates-available }}ê°œ íŒ¨í‚¤ì§€"
        body: |
          ## ğŸ“¦ ìë™ ì˜ì¡´ì„± ì—…ë°ì´íŠ¸ PR
          
          ### ğŸ“Š ì—…ë°ì´íŠ¸ í˜„í™©
          - **ì—…ë°ì´íŠ¸ ê°€ëŠ¥í•œ íŒ¨í‚¤ì§€**: ${{ needs.dependency-analysis.outputs.updates-available }}ê°œ
          - **ë³´ì•ˆ ê´€ë ¨ ì—…ë°ì´íŠ¸**: ${{ needs.dependency-analysis.outputs.security-updates }}ê°œ
          - **ì—…ë°ì´íŠ¸ íƒ€ì…**: ë§ˆì´ë„ˆ ë²„ì „ (ì•ˆì „í•œ ì—…ë°ì´íŠ¸)
          
          ### âœ… ê²€ì¦ ì™„ë£Œ ì‚¬í•­
          - íŒ¨í‚¤ì§€ í˜¸í™˜ì„± ê²€ì¦ ì™„ë£Œ
          - í•µì‹¬ ëª¨ë“ˆ ì„í¬íŠ¸ í…ŒìŠ¤íŠ¸ í†µê³¼
          - ì˜ì¡´ì„± ì¶©ëŒ í™•ì¸ ì™„ë£Œ
          
          ### ğŸ§ª ì¶”ê°€ í…ŒìŠ¤íŠ¸ ê¶Œì¥
          - [ ] ì „ì²´ í…ŒìŠ¤íŠ¸ ìŠ¤ìœ„íŠ¸ ì‹¤í–‰
          - [ ] ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
          - [ ] ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ í™•ì¸
          - [ ] í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰
          
          ### ğŸ“‹ ì£¼ìš” ì—…ë°ì´íŠ¸ ë‚´ìš©
          ì—…ë°ì´íŠ¸ëœ íŒ¨í‚¤ì§€ ëª©ë¡ì€ ë³€ê²½ëœ `requirements.txt` íŒŒì¼ì—ì„œ í™•ì¸í•˜ì„¸ìš”.
          
          ### ğŸ¤– ìë™í™” ì •ë³´
          - ìƒì„±ì: AI ìë™í™” í”Œë«í¼ v8.3.0
          - ì—…ë°ì´íŠ¸ ì¼ì‹œ: ${{ github.run_started_at }}
          - ì—…ë°ì´íŠ¸ ì •ì±…: ë³´ìˆ˜ì  (ë§ˆì´ë„ˆ ë²„ì „ë§Œ)
          - ìë™ ê²€ì¦: ê¸°ë³¸ í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸ í†µê³¼
          
          ---
          **ğŸ’¡ ì´ PRì„ ë¨¸ì§€í•˜ê¸° ì „ì— ì „ì²´ CI/CD íŒŒì´í”„ë¼ì¸ì„ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.**
        branch: dependencies/auto-update-${{ github.run_number }}
        delete-branch: true
        draft: true
        labels: |
          dependencies
          automated
          minor-update

  # ================================
  # SECURITY SUMMARY REPORT
  # ================================
  security-summary:
    name: ğŸ“Š Security Summary Report
    runs-on: ubuntu-latest
    needs: [vulnerability-scan, dependency-analysis, security-fixes, dependency-updates-pr]
    if: always()
    
    steps:
    - name: ğŸ“Š Generate Korean Security Report
      run: |
        echo "## ğŸ›¡ï¸ ë³´ì•ˆ ë° ì˜ì¡´ì„± ê´€ë¦¬ ì¼ì¼ ë¦¬í¬íŠ¸" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ğŸ“… ë¦¬í¬íŠ¸ ì •ë³´" >> $GITHUB_STEP_SUMMARY
        echo "- **ì‹¤í–‰ ì¼ì‹œ**: $(date '+%Yë…„ %mì›” %dì¼ %H:%M KST')" >> $GITHUB_STEP_SUMMARY
        echo "- **ì›Œí¬í”Œë¡œìš°**: ìë™ ì˜ì¡´ì„± ë° ë³´ì•ˆ ê´€ë¦¬ v8.3.0" >> $GITHUB_STEP_SUMMARY
        echo "- **ì‹¤í–‰ ìœ í˜•**: ${{ github.event_name }}" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        echo "### ğŸ” ë³´ì•ˆ ìŠ¤ìº” ê²°ê³¼" >> $GITHUB_STEP_SUMMARY
        echo "- **ì´ ì·¨ì•½ì  ë°œê²¬**: ${{ needs.vulnerability-scan.outputs.vulnerabilities-found }}ê°œ" >> $GITHUB_STEP_SUMMARY
        echo "- **ì‹¬ê°/ë†’ìŒ ìœ„í—˜**: ${{ needs.vulnerability-scan.outputs.critical-count }}ê°œ" >> $GITHUB_STEP_SUMMARY
        echo "- **ë³´í†µ ìœ„í—˜**: ${{ needs.vulnerability-scan.outputs.high-count }}ê°œ" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        echo "### ğŸ“¦ ì˜ì¡´ì„± ì—…ë°ì´íŠ¸ í˜„í™©" >> $GITHUB_STEP_SUMMARY
        echo "- **ì—…ë°ì´íŠ¸ ê°€ëŠ¥í•œ íŒ¨í‚¤ì§€**: ${{ needs.dependency-analysis.outputs.updates-available }}ê°œ" >> $GITHUB_STEP_SUMMARY
        echo "- **ë³´ì•ˆ ê´€ë ¨ ì—…ë°ì´íŠ¸**: ${{ needs.dependency-analysis.outputs.security-updates }}ê°œ" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        echo "### ğŸ”§ ìë™ ìˆ˜ì • ì¡°ì¹˜" >> $GITHUB_STEP_SUMMARY
        if [ "${{ needs.security-fixes.result }}" == "success" ]; then
          echo "- âœ… **ë³´ì•ˆ ìˆ˜ì • PR ìƒì„±ë¨**: ì‹¬ê°í•œ ì·¨ì•½ì  ìë™ íŒ¨ì¹˜" >> $GITHUB_STEP_SUMMARY
        elif [ "${{ needs.vulnerability-scan.outputs.critical-count }}" == "0" ]; then
          echo "- âœ… **ë³´ì•ˆ ìˆ˜ì • ë¶ˆí•„ìš”**: ì‹¬ê°í•œ ì·¨ì•½ì  ì—†ìŒ" >> $GITHUB_STEP_SUMMARY  
        else
          echo "- âš ï¸ **ë³´ì•ˆ ìˆ˜ì • ì‹¤íŒ¨**: ìˆ˜ë™ ê²€í†  í•„ìš”" >> $GITHUB_STEP_SUMMARY
        fi
        
        if [ "${{ needs.dependency-updates-pr.result }}" == "success" ]; then
          echo "- âœ… **ì˜ì¡´ì„± ì—…ë°ì´íŠ¸ PR ìƒì„±ë¨**: ë“œë˜í”„íŠ¸ ìƒíƒœ" >> $GITHUB_STEP_SUMMARY
        elif [ "${{ needs.dependency-analysis.outputs.updates-available }}" == "0" ]; then
          echo "- âœ… **ì˜ì¡´ì„± ì—…ë°ì´íŠ¸ ë¶ˆí•„ìš”**: ëª¨ë“  íŒ¨í‚¤ì§€ ìµœì‹  ìƒíƒœ" >> $GITHUB_STEP_SUMMARY
        else
          echo "- âš ï¸ **ì˜ì¡´ì„± ì—…ë°ì´íŠ¸ ì‹¤íŒ¨**: ìˆ˜ë™ ê²€í†  í•„ìš”" >> $GITHUB_STEP_SUMMARY
        fi
        echo "" >> $GITHUB_STEP_SUMMARY
        
        echo "### ğŸ“‹ ê¶Œì¥ ì¡°ì¹˜ì‚¬í•­" >> $GITHUB_STEP_SUMMARY
        
        if [ "${{ needs.vulnerability-scan.outputs.critical-count }}" -gt "0" ]; then
          echo "- ğŸš¨ **ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš”**: ì‹¬ê°í•œ ë³´ì•ˆ ì·¨ì•½ì  ${{ needs.vulnerability-scan.outputs.critical-count }}ê°œ ë°œê²¬" >> $GITHUB_STEP_SUMMARY
          echo "  - ìë™ ìƒì„±ëœ ë³´ì•ˆ ìˆ˜ì • PR ê²€í†  ë° ë¨¸ì§€" >> $GITHUB_STEP_SUMMARY
          echo "  - í”„ë¡œë•ì…˜ í™˜ê²½ ê¸´ê¸‰ ì—…ë°ì´íŠ¸ ê³ ë ¤" >> $GITHUB_STEP_SUMMARY
        fi
        
        if [ "${{ needs.dependency-analysis.outputs.updates-available }}" -gt "10" ]; then
          echo "- ğŸ“¦ **ì •ê¸° ì—…ë°ì´íŠ¸ ê¶Œì¥**: ì—…ë°ì´íŠ¸ ê°€ëŠ¥í•œ íŒ¨í‚¤ì§€ê°€ ë§ìŒ" >> $GITHUB_STEP_SUMMARY
          echo "  - ìë™ ìƒì„±ëœ ì˜ì¡´ì„± ì—…ë°ì´íŠ¸ PR ê²€í† " >> $GITHUB_STEP_SUMMARY
          echo "  - ìŠ¤í…Œì´ì§• í™˜ê²½ì—ì„œ ì¶©ë¶„í•œ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰" >> $GITHUB_STEP_SUMMARY
        fi
        
        if [ "${{ needs.vulnerability-scan.outputs.vulnerabilities-found }}" -eq "0" ] && [ "${{ needs.dependency-analysis.outputs.updates-available }}" -eq "0" ]; then
          echo "- âœ… **ìš°ìˆ˜í•œ ë³´ì•ˆ ìƒíƒœ**: ì¶”ê°€ ì¡°ì¹˜ ë¶ˆí•„ìš”" >> $GITHUB_STEP_SUMMARY
          echo "  - í˜„ì¬ ë³´ì•ˆ ìƒíƒœ ìœ ì§€" >> $GITHUB_STEP_SUMMARY
          echo "  - ì •ê¸° ëª¨ë‹ˆí„°ë§ ì§€ì†" >> $GITHUB_STEP_SUMMARY
        fi
        
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ğŸ”— ê´€ë ¨ ë¦¬ì†ŒìŠ¤" >> $GITHUB_STEP_SUMMARY
        echo "- [ë³´ì•ˆ ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ](../../actions/runs/${{ github.run_id }})" >> $GITHUB_STEP_SUMMARY
        echo "- [ì˜ì¡´ì„± ë¶„ì„ ë³´ê³ ì„œ](../../actions/runs/${{ github.run_id }})" >> $GITHUB_STEP_SUMMARY
        echo "- [AI ìë™í™” í”Œë«í¼ ë¬¸ì„œ](../../../docs/automation)" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "---" >> $GITHUB_STEP_SUMMARY
        echo "**ğŸ¤– ì´ ë¦¬í¬íŠ¸ëŠ” AI ìë™í™” í”Œë«í¼ v8.3.0ì— ì˜í•´ ìë™ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.**" >> $GITHUB_STEP_SUMMARY
        
        echo "ğŸ‰ ì¼ì¼ ë³´ì•ˆ ë° ì˜ì¡´ì„± ê´€ë¦¬ ì™„ë£Œ!"
        echo "ğŸ“Š ì´ ì·¨ì•½ì : ${{ needs.vulnerability-scan.outputs.vulnerabilities-found }}ê°œ"
        echo "ğŸ“¦ ì—…ë°ì´íŠ¸ ê°€ëŠ¥: ${{ needs.dependency-analysis.outputs.updates-available }}ê°œ"
        
    - name: ğŸ“§ Send Notification (if critical)
      if: needs.vulnerability-scan.outputs.critical-count > 0
      run: |
        echo "ğŸš¨ ì‹¬ê°í•œ ë³´ì•ˆ ì·¨ì•½ì  ${{ needs.vulnerability-scan.outputs.critical-count }}ê°œ ë°œê²¬!"
        echo "ğŸ“§ ë³´ì•ˆíŒ€ ì•Œë¦¼ ë°œì†¡ ì¤‘..."
        # ì—¬ê¸°ì— ì‹¤ì œ ì•Œë¦¼ ì‹œìŠ¤í…œ ì—°ë™ (Slack, Teams, Email ë“±)
        echo "âœ… ì•Œë¦¼ ë°œì†¡ ì™„ë£Œ"