apiVersion: v1
kind: Secret
metadata:
  name: helm-repo-jclee
  namespace: argocd
  labels:
    argocd.argoproj.io/secret-type: repository
type: Opaque
stringData:
  type: helm
  name: jclee-charts
  url: https://charts.jclee.me
  # If authentication is required, uncomment below
  # username: <username>
  # password: <password>
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-cm
  namespace: argocd
data:
  repositories: |
    - type: helm
      name: jclee-charts
      url: https://charts.jclee.me
  repository.credentials: |
    - url: https://charts.jclee.me
      # passwordSecret and usernameSecret if needed
  resource.customizations: |
    apps/Deployment:
      health.lua: |
        hs = {}
        if obj.status ~= nil then
          if obj.status.replicas ~= nil and obj.status.readyReplicas ~= nil then
            if obj.status.replicas == obj.status.readyReplicas then
              hs.status = "Healthy"
              hs.message = "All replicas are ready"
            else
              hs.status = "Progressing"
              hs.message = "Waiting for all replicas to be ready"
            end
          end
        end
        return hs