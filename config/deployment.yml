# 배포 관련 설정 중앙화

# 기본 배포 설정
default: &default
  registry:
    url: "${DOCKER_REGISTRY:-registry.jclee.me}"
    username: "${REGISTRY_USERNAME:-qws941}"
    password: "${REGISTRY_PASSWORD}"
  
  deployment:
    host: "${DEPLOY_HOST:-registry.jclee.me}"
    ssh_port: "${DEPLOY_SSH_PORT:-1112}"
    user: "${DEPLOY_USER:-docker}"
    method: watchtower  # watchtower, ssh, docker-swarm
  
  application:
    name: "${IMAGE_NAME:-blacklist}"
    port: "${APP_PORT:-2541}"
    staging_port: "${STAGING_PORT:-2542}"
  
  watchtower:
    poll_interval: 30
    cleanup: true
    include_stopped: true
    include_restarting: true
    label_enable: true
    rolling_restart: true

# 환경별 배포 설정
development:
  <<: *default
  registry:
    <<: *default.registry
    url: localhost:5000
  deployment:
    <<: *default.deployment
    host: localhost
    method: local

staging:
  <<: *default
  application:
    <<: *default.application
    port: 2542

production:
  <<: *default

# CI/CD 파이프라인 설정
cicd:
  github:
    actions:
      runner: self-hosted
      timeout: 600  # 10 minutes
      
  stages:
    test:
      enabled: true
      timeout: 300
      coverage: true
      security_scan: true
    
    build:
      enabled: true
      timeout: 600
      platforms: linux/amd64
      cache: true
      
    deploy:
      enabled: true
      timeout: 300
      strategy: watchtower
      
    verify:
      enabled: true
      timeout: 600  # 10 minutes for Watchtower deployment
      max_attempts: 60
      attempt_interval: 10
      
  notifications:
    slack:
      enabled: "${SLACK_WEBHOOK:-false}"
    github:
      enabled: true
      deployment_status: true