version: '3.9'

services:
  watchtower:
    image: containrrr/watchtower:latest
    container_name: watchtower
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /root/.docker/config.json:/config.json:ro
    environment:
      # 업데이트 체크 간격 (초 단위, 300 = 5분)
      WATCHTOWER_POLL_INTERVAL: 300
      # 업데이트할 컨테이너 라벨
      WATCHTOWER_LABEL_ENABLE: "true"
      # 알림 설정 (선택사항)
      WATCHTOWER_NOTIFICATIONS: email
      WATCHTOWER_NOTIFICATION_EMAIL_FROM: blacklist@jclee.me
      WATCHTOWER_NOTIFICATION_EMAIL_TO: admin@jclee.me
      WATCHTOWER_NOTIFICATION_EMAIL_SERVER: smtp.gmail.com
      WATCHTOWER_NOTIFICATION_EMAIL_SERVER_PORT: 587
      WATCHTOWER_NOTIFICATION_EMAIL_SERVER_USER: your-email@gmail.com
      WATCHTOWER_NOTIFICATION_EMAIL_SERVER_PASSWORD: your-app-password
      # 오래된 이미지 자동 삭제
      WATCHTOWER_CLEANUP: "true"
      # 디버그 로그
      WATCHTOWER_DEBUG: "false"
      # 한국 시간대
      TZ: Asia/Seoul
    command: --schedule "0 0 2 * * *"  # 매일 새벽 2시 업데이트
    networks:
      - blacklist-network
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

networks:
  blacklist-network:
    external: true
    name: blacklist-network