apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-image-updater-config
  namespace: argocd
data:
  # Private Registry ì„¤ì • (ì¸ì¦ ì‚¬ìš©)
  registries.conf: |
    registries:
    - name: private-registry
      api_url: https://registry.jclee.me
      prefix: registry.jclee.me
      ping: yes
      insecure: no
      credentials: pullsecret:argocd/registry-credentials
      defaultns: library
      limit: 100
  
  # ë¡œê·¸ ë ˆë²¨ ì„¤ì •
  log.level: "info"
  
  # Git ì»¤ë°‹ ì„¤ì •
  git.commit-message-template: |
    build: automatic image update
    
    {{range .Images}}
    - {{.Image}}:{{.Tag}}
    {{end}}
    
    ğŸ¤– Updated by ArgoCD Image Updater
  
  # ì—…ë°ì´íŠ¸ ê°„ê²© (ì´ˆ)
  interval: "120"  # 2ë¶„ë§ˆë‹¤ ì²´í¬
  
---
# Private Registry Secret (ì¸ì¦ ë¶ˆí•„ìš”í•˜ì§€ë§Œ ArgoCD Image Updater í˜¸í™˜ì„±ìš©)
apiVersion: v1
kind: Secret
metadata:
  name: registry-credentials
  namespace: argocd
type: kubernetes.io/dockerconfigjson
data:
  # registry.jclee.me ì¸ì¦ ì •ë³´ (admin:bingogo1)
  .dockerconfigjson: eyJhdXRocyI6eyJyZWdpc3RyeS5qY2xlZS1tZSI6eyJ1c2VybmFtZSI6ImFkbWluIiwicGFzc3dvcmQiOiJiaW5nb2dvMSIsImF1dGgiOiJZV1J0YVc0NlltbHVaMjluYnpFPSJ9fX0=
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: argocd-image-updater
  namespace: argocd
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: argocd-image-updater
  namespace: argocd
rules:
- apiGroups:
  - argoproj.io
  resources:
  - applications
  verbs:
  - get
  - list
  - update
  - patch
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - get
  - list
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - create
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: argocd-image-updater
  namespace: argocd
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: argocd-image-updater
subjects:
- kind: ServiceAccount
  name: argocd-image-updater
  namespace: argocd