apiVersion: v1
kind: ConfigMap
metadata:
  name: blacklist-base-config
data:
  # 애플리케이션 기본 설정
  app.conf: |
    # Flask Configuration
    FLASK_ENV=production
    PROPAGATE_EXCEPTIONS=True
    
    # Logging
    LOG_FORMAT=json
    LOG_LEVEL=info
    
    # Performance
    RESPONSE_TIMEOUT=30
    MAX_CONTENT_LENGTH=16777216
    
    # Security
    SESSION_COOKIE_SECURE=True
    SESSION_COOKIE_HTTPONLY=True
    SESSION_COOKIE_SAMESITE=Lax
  
  # Gunicorn 설정
  gunicorn.conf.py: |
    import multiprocessing
    import os
    
    bind = f"0.0.0.0:{os.environ.get('PORT', '8541')}"
    workers = multiprocessing.cpu_count() * 2 + 1
    worker_class = "sync"
    worker_connections = 1000
    timeout = 120
    keepalive = 2
    
    # 로깅
    accesslog = "-"
    errorlog = "-"
    loglevel = os.environ.get('LOG_LEVEL', 'info')
    access_log_format = '%(h)s %(l)s %(u)s %(t)s "%(r)s" %(s)s %(b)s "%(f)s" "%(a)s" %(D)s'
    
    # 프로세스 관리
    max_requests = 1000
    max_requests_jitter = 50
    preload_app = True
    
    # 성능 최적화
    worker_tmp_dir = "/dev/shm"