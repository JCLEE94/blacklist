# Kustomization patch for automatic image updates
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - 00-argocd-app.yaml
  - 01-namespace.yaml
  - 02-configmap.yaml
  - 03-secret.yaml
  - 04-pvc.yaml
  - 05-serviceaccount.yaml
  - 06-deployment.yaml
  - 07-service.yaml
  - 08-ingress.yaml
  - 09-redis.yaml

images:
  - name: registry.jclee.me/blacklist
    newTag: latest
    
# Force rolling updates when image changes
patches:
  - target:
      kind: Deployment
      name: blacklist
    patch: |-
      - op: add
        path: /spec/template/metadata/annotations/kubectl.kubernetes.io~1restartedAt
        value: "AUTO_REPLACED_BY_ARGOCD"
      - op: replace
        path: /spec/template/spec/containers/0/imagePullPolicy
        value: Always