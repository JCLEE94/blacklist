apiVersion: v1
kind: Namespace
metadata:
  name: microservices
  labels:
    name: microservices
    infrastructure: jclee.me
    deployment-type: msa
    istio-injection: disabled  # 향후 Service Mesh 도입 시 enabled로 변경
  annotations:
    # 리소스 할당량 및 제한
    scheduler.alpha.kubernetes.io/preferred-durations: "10m"
    
---
# 리소스 할당량
apiVersion: v1
kind: ResourceQuota
metadata:
  name: microservices-quota
  namespace: microservices
  labels:
    infrastructure: jclee.me
spec:
  hard:
    # 컴퓨팅 리소스
    requests.cpu: "8"          # 8 CPU 코어 요청
    requests.memory: 16Gi      # 16GB 메모리 요청
    limits.cpu: "16"           # 16 CPU 코어 제한
    limits.memory: 32Gi        # 32GB 메모리 제한
    
    # 스토리지
    requests.storage: 100Gi    # 100GB 스토리지 요청
    persistentvolumeclaims: "10"  # PVC 개수 제한
    
    # 오브젝트 개수
    pods: "50"                 # Pod 개수 제한
    services: "20"             # Service 개수 제한
    secrets: "20"              # Secret 개수 제한
    configmaps: "20"           # ConfigMap 개수 제한
    replicationcontrollers: "20"
    
    # 로드밸런서 및 NodePort 제한
    services.nodeports: "5"    # NodePort 서비스 제한
    services.loadbalancers: "3" # LoadBalancer 서비스 제한

---
# 제한 범위 (기본값 설정)
apiVersion: v1
kind: LimitRange
metadata:
  name: microservices-limits
  namespace: microservices
  labels:
    infrastructure: jclee.me
spec:
  limits:
    # Pod 기본값 및 제한
    - default:
        cpu: "500m"          # 기본 CPU 제한
        memory: "512Mi"      # 기본 메모리 제한
      defaultRequest:
        cpu: "100m"          # 기본 CPU 요청
        memory: "128Mi"      # 기본 메모리 요청
      max:
        cpu: "2"             # 최대 CPU 제한
        memory: "4Gi"        # 최대 메모리 제한
      min:
        cpu: "50m"           # 최소 CPU 요청
        memory: "64Mi"       # 최소 메모리 요청
      type: Container
    
    # PVC 제한
    - max:
        storage: 10Gi        # 최대 스토리지 크기
      min:
        storage: 1Gi         # 최소 스토리지 크기
      type: PersistentVolumeClaim