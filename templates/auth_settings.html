<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ì¦ ì„¤ì • - Blacklist Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .config-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            border: 1px solid #dee2e6;
            border-radius: 0.5rem;
            background-color: #f8f9fa;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-enabled { background-color: #28a745; }
        .status-disabled { background-color: #dc3545; }
        .password-set { color: #28a745; font-weight: bold; }
        .password-unset { color: #dc3545; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <header class="d-flex justify-content-between align-items-center py-3 mb-4 border-bottom">
                    <h1 class="h3">ğŸ” ì¸ì¦ ì„¤ì •</h1>
                    <nav>
                        <a href="/" class="btn btn-outline-primary">ëŒ€ì‹œë³´ë“œ</a>
                        <a href="/system-settings" class="btn btn-outline-secondary">ì‹œìŠ¤í…œ ì„¤ì •</a>
                    </nav>
                </header>

                <div class="alert alert-info">
                    <strong>ğŸ“¢ ì¤‘ìš”:</strong> ì¸ì¦ ì •ë³´ëŠ” ì•ˆì „í•˜ê²Œ ì•”í˜¸í™”ë˜ì–´ ì €ì¥ë©ë‹ˆë‹¤. 
                    ë³€ê²½ í›„ ìˆ˜ì§‘ ì„œë¹„ìŠ¤ë¥¼ ì¬ì‹œì‘í•˜ì—¬ ìƒˆ ì„¤ì •ì„ ì ìš©í•˜ì„¸ìš”.
                </div>

                <!-- REGTECH ì„¤ì • -->
                <div class="config-section">
                    <h3>
                        <span id="regtech-status" class="status-indicator status-disabled"></span>
                        REGTECH (ê¸ˆìœµë³´ì•ˆì›)
                    </h3>
                    <form id="regtech-form">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="regtech-username" class="form-label">ì‚¬ìš©ìëª…</label>
                                    <input type="text" class="form-control" id="regtech-username" 
                                           placeholder="REGTECH ì‚¬ìš©ìëª…">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="regtech-password" class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                                    <input type="password" class="form-control" id="regtech-password" 
                                           placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ (ë³€ê²½ì‹œì—ë§Œ ì…ë ¥)">
                                    <div class="form-text">
                                        í˜„ì¬ ìƒíƒœ: <span id="regtech-password-status" class="password-unset">ì„¤ì •ë˜ì§€ ì•ŠìŒ</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="regtech-enabled">
                                <label class="form-check-label" for="regtech-enabled">
                                    REGTECH ìˆ˜ì§‘ í™œì„±í™”
                                </label>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">REGTECH ì„¤ì • ì €ì¥</button>
                    </form>
                </div>

                <!-- SECUDIUM ì„¤ì • -->
                <div class="config-section">
                    <h3>
                        <span id="secudium-status" class="status-indicator status-disabled"></span>
                        SECUDIUM
                    </h3>
                    <form id="secudium-form">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="secudium-username" class="form-label">ì‚¬ìš©ìëª…</label>
                                    <input type="text" class="form-control" id="secudium-username" 
                                           placeholder="SECUDIUM ì‚¬ìš©ìëª…">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="secudium-password" class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                                    <input type="password" class="form-control" id="secudium-password" 
                                           placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ (ë³€ê²½ì‹œì—ë§Œ ì…ë ¥)">
                                    <div class="form-text">
                                        í˜„ì¬ ìƒíƒœ: <span id="secudium-password-status" class="password-unset">ì„¤ì •ë˜ì§€ ì•ŠìŒ</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="secudium-enabled">
                                <label class="form-check-label" for="secudium-enabled">
                                    SECUDIUM ìˆ˜ì§‘ í™œì„±í™”
                                </label>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">SECUDIUM ì„¤ì • ì €ì¥</button>
                    </form>
                </div>

                <!-- í…ŒìŠ¤íŠ¸ ë° ìƒíƒœ -->
                <div class="config-section">
                    <h3>ğŸ§ª ì—°ê²° í…ŒìŠ¤íŠ¸</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <button id="test-regtech" class="btn btn-info w-100">REGTECH ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                        </div>
                        <div class="col-md-6">
                            <button id="test-secudium" class="btn btn-info w-100">SECUDIUM ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                        </div>
                    </div>
                    <div id="test-results" class="mt-3"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ì„¤ì • ë¡œë“œ
        async function loadConfig() {
            try {
                const response = await fetch('/api/auth-config');
                const data = await response.json();
                
                if (data.success) {
                    const config = data.config;
                    
                    // REGTECH ì„¤ì • ì ìš©
                    document.getElementById('regtech-username').value = config.regtech.username;
                    document.getElementById('regtech-enabled').checked = config.regtech.enabled;
                    document.getElementById('regtech-status').className = 
                        'status-indicator ' + (config.regtech.enabled ? 'status-enabled' : 'status-disabled');
                    document.getElementById('regtech-password-status').textContent = 
                        config.regtech.password_set ? 'ì„¤ì •ë¨' : 'ì„¤ì •ë˜ì§€ ì•ŠìŒ';
                    document.getElementById('regtech-password-status').className = 
                        config.regtech.password_set ? 'password-set' : 'password-unset';
                        
                    // SECUDIUM ì„¤ì • ì ìš©
                    document.getElementById('secudium-username').value = config.secudium.username;
                    document.getElementById('secudium-enabled').checked = config.secudium.enabled;
                    document.getElementById('secudium-status').className = 
                        'status-indicator ' + (config.secudium.enabled ? 'status-enabled' : 'status-disabled');
                    document.getElementById('secudium-password-status').textContent = 
                        config.secudium.password_set ? 'ì„¤ì •ë¨' : 'ì„¤ì •ë˜ì§€ ì•ŠìŒ';
                    document.getElementById('secudium-password-status').className = 
                        config.secudium.password_set ? 'password-set' : 'password-unset';
                }
            } catch (error) {
                console.error('ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // REGTECH ì„¤ì • ì €ì¥
        document.getElementById('regtech-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const data = {
                regtech: {
                    username: document.getElementById('regtech-username').value,
                    password: document.getElementById('regtech-password').value,
                    enabled: document.getElementById('regtech-enabled').checked
                }
            };
            
            try {
                const response = await fetch('/api/auth-config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                if (result.success) {
                    alert('REGTECH ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    document.getElementById('regtech-password').value = ''; // ë¹„ë°€ë²ˆí˜¸ í•„ë“œ í´ë¦¬ì–´
                    loadConfig(); // ì„¤ì • ìƒˆë¡œê³ ì¹¨
                } else {
                    alert('ì €ì¥ ì‹¤íŒ¨: ' + result.error);
                }
            } catch (error) {
                alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
            }
        });

        // SECUDIUM ì„¤ì • ì €ì¥
        document.getElementById('secudium-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const data = {
                secudium: {
                    username: document.getElementById('secudium-username').value,
                    password: document.getElementById('secudium-password').value,
                    enabled: document.getElementById('secudium-enabled').checked
                }
            };
            
            try {
                const response = await fetch('/api/auth-config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                if (result.success) {
                    alert('SECUDIUM ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    document.getElementById('secudium-password').value = ''; // ë¹„ë°€ë²ˆí˜¸ í•„ë“œ í´ë¦¬ì–´
                    loadConfig(); // ì„¤ì • ìƒˆë¡œê³ ì¹¨
                } else {
                    alert('ì €ì¥ ì‹¤íŒ¨: ' + result.error);
                }
            } catch (error) {
                alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
            }
        });

        // ì—°ê²° í…ŒìŠ¤íŠ¸
        document.getElementById('test-regtech').addEventListener('click', async () => {
            showTestResult('REGTECH ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...', 'info');
            try {
                const response = await fetch('/api/collection/regtech/trigger', { method: 'POST' });
                const result = await response.json();
                showTestResult(
                    'REGTECH: ' + (result.success ? 'ì—°ê²° ì„±ê³µ' : 'ì—°ê²° ì‹¤íŒ¨ - ' + result.message), 
                    result.success ? 'success' : 'danger'
                );
            } catch (error) {
                showTestResult('REGTECH í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ' + error.message, 'danger');
            }
        });

        document.getElementById('test-secudium').addEventListener('click', async () => {
            showTestResult('SECUDIUM ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...', 'info');
            try {
                const response = await fetch('/api/collection/secudium/trigger', { method: 'POST' });
                const result = await response.json();
                showTestResult(
                    'SECUDIUM: ' + (result.success ? 'ì—°ê²° ì„±ê³µ' : 'ì—°ê²° ì‹¤íŒ¨ - ' + result.message), 
                    result.success ? 'success' : 'danger'
                );
            } catch (error) {
                showTestResult('SECUDIUM í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ' + error.message, 'danger');
            }
        });

        function showTestResult(message, type) {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = `<div class="alert alert-${type}" role="alert">${message}</div>`;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„¤ì • ë¡œë“œ
        loadConfig();
    </script>
</body>
</html>